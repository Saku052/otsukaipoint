# おつかいポイント アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
おつかいポイント

### 1.2 目的
親子で買い物リストを共有し、子供がお使いを完了することでお小遣いを獲得できるシステムの構築

### 1.3 技術スタック
- **フロントエンド**: Flutter（iOS/Android/タブレット対応）
- **バックエンド**: Supabase
- **認証**: Google認証（Supabase Auth）
- **データベース**: Supabase PostgreSQL
- **通知**: Supabase Realtime + Edge Functions
- **アーキテクチャ**: Clean Architecture + Riverpod
- **UI/UX**: Material Design 3

## 2. システム要件

### 2.1 ユーザー管理・認証システム

#### 2.1.1 アカウント構成
- **親アカウント**: 最大2つまで
- **子アカウント**: 最大2つまで
- **年齢制限**: なし

#### 2.1.2 認証方式
- **親**: Google認証（Supabase Auth）
- **子**: 親が管理する形式

#### 2.1.3 アカウント管理
- 親による子アカウントの一時停止機能
- 親による子アカウントの削除・再連携機能

### 2.2 買い物リスト機能

#### 2.2.1 リスト作成・管理
- **作成者**: 親のみ
- **複数リスト**: 同時作成可能
- **有効期限**: カレンダー形式で親が設定
- **商品情報**: 
  - 商品名（必須）
  - 価格目安（任意）
  - 購入場所の提案（任意）
  - お小遣い金額（必須）

#### 2.2.2 子供の操作
- **閲覧**: 全リスト閲覧可能
- **完了報告**: 商品に完了マークを付与
- **権限制限**: 追加・削除・編集不可

#### 2.2.3 共有機能
- 複数の子供が同じリストの異なる商品を担当可能
- リアルタイム同期は不要
- 商品追加時は子供に通知

### 2.3 お小遣いシステム

#### 2.3.1 お小遣い設定
- **設定方法**: 商品ごと個別設定 or 一律設定
- **設定者**: 親
- **金額制限**: 最大・最小制限なし

#### 2.3.2 承認システム
- **承認者**: 親
- **承認期限**: なし
- **承認拒否**: 理由入力不要、再完了報告可能

#### 2.3.3 残高管理
- **残高上限**: なし
- **履歴管理**: 獲得履歴・使用履歴の記録
- **残高調整**: 親による追加・減額機能

### 2.4 親子連携・QRコード機能

#### 2.4.1 QRコード仕様
- **生成**: 親が生成
- **読み取り**: 子が読み取り
- **有効期限**: 5分
- **連携数**: 一つのQRコードで複数の子供が連携可能

#### 2.4.2 連携プロセス
- **子の名前設定**: 子供が自分で設定
- **名前変更制限**: 設定後1週間は変更不可
- **承認ステップ**: 不要（即時連携）

### 2.5 通知機能

#### 2.5.1 通知タイミング
- 商品が追加された時
- 子供が完了報告した時
- 親が承認/拒否した時

#### 2.5.2 通知方式
- **Supabase Realtime**: リアルタイムデータ変更通知
- **アプリ内通知**: notifications テーブルでの通知管理
- **Edge Functions**: カスタム通知ロジック
- **個別設定**: 各通知のオン/オフ切り替え可能

## 3. 非機能要件

### 3.1 対応端末
- **iOS**: iPhone・iPad
- **Android**: スマートフォン・タブレット

### 3.2 データ保持
- **削除データ**: 1週間保持
- **QRコード有効期限**: 5分
- **買い物リスト有効期限**: 親がカレンダーで設定

### 3.3 セキュリティ
- Google認証による安全な認証
- 親による子アカウント管理
- QRコード期限切れ時の自動更新

## 4. 画面構成

### 4.1 親用画面
- **ダッシュボード**: 子供の進捗・残高確認
- **リスト作成**: 買い物リスト作成・編集
- **QRコード生成**: 子供連携用QRコード表示
- **承認管理**: 子供の完了報告承認/拒否
- **残高管理**: 子供のお小遣い残高調整
- **設定**: 通知設定・アカウント管理

### 4.2 子用画面
- **リスト一覧**: 担当する買い物リスト表示
- **完了報告**: 商品完了マーク機能
- **残高表示**: 現在のお小遣い残高
- **履歴**: 獲得・使用履歴
- **設定**: 名前変更・通知設定

## 5. データベース設計

### 5.1 主要テーブル
- **users**: ユーザー情報（親・子）
- **families**: 家族グループ管理
- **shopping_lists**: 買い物リスト
- **shopping_items**: 商品情報
- **allowances**: お小遣い管理
- **notifications**: 通知履歴
- **qr_codes**: QRコード管理

## 6. 開発フェーズ

### 6.1 初期リリース（MVP）
上記全機能を含む基本システムの実装

### 6.2 今後の拡張予定
- 親子間メッセージ機能
- 商品写真撮影機能
- 統計・レポート機能
- ゲーミフィケーション要素

## 7. 成功指標

### 7.1 機能指標
- 親子連携成功率 > 95%
- 完了報告〜承認時間 < 24時間
- アプリクラッシュ率 < 0.1%

### 7.2 ユーザー指標
- 月間アクティブユーザー継続率 > 70%
- 買い物リスト完了率 > 80%
- プッシュ通知開封率 > 50%